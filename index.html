<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CalcPro‚Ñ¢ ‚Äî La Calculadora Definitiva</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0f0f;
    --surface: #1a1a1a;
    --surface2: #242424;
    --border: #2e2e2e;
    --text: #f0f0f0;
    --muted: #888;
    --accent: #ff3c3c;
    --accent2: #ff9500;
    --btn-bg: #222;
    --btn-op: #2d2d2d;
    --btn-eq: #ff3c3c;
    --display-bg: #111;
  }
  .theme-light {
    --bg: #e8e8e8;
    --surface: #f2f2f2;
    --surface2: #ffffff;
    --border: #ccc;
    --text: #111;
    --muted: #666;
    --btn-bg: #ddd;
    --btn-op: #c8c8c8;
    --btn-eq: #ff3c3c;
    --display-bg: #fff;
  }
  .theme-retro {
    --bg: #1a0a00;
    --surface: #2a1200;
    --surface2: #3a1a00;
    --border: #553300;
    --text: #ff9900;
    --muted: #aa5500;
    --btn-bg: #2a1200;
    --btn-op: #3a1a00;
    --btn-eq: #ff6600;
    --display-bg: #0a0500;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(255,60,60,0.05) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(255,149,0,0.05) 0%, transparent 60%);
    pointer-events: none;
  }

  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    padding: 12px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    z-index: 10;
  }

  .logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 2px;
    color: var(--accent);
  }
  .logo span { color: var(--text); }

  .header-right { display: flex; gap: 10px; align-items: center; }

  .badge {
    background: var(--accent);
    color: white;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 3px;
    letter-spacing: 1px;
    text-transform: uppercase;
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.6} }

  .theme-btn {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    transition: all 0.2s;
  }
  .theme-btn:hover { background: var(--btn-op); border-color: var(--accent); }

  /* CALCULATOR */
  .calc-wrapper {
    margin-top: 60px;
    padding: 20px;
  }

  .calc {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: 320px;
    overflow: hidden;
    box-shadow: 0 30px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.05);
  }

  .display {
    background: var(--display-bg);
    padding: 20px 20px 14px;
    min-height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: flex-end;
    border-bottom: 1px solid var(--border);
  }

  .display .sub {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    color: var(--muted);
    min-height: 20px;
  }

  .display .main {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2.4rem;
    font-weight: 700;
    letter-spacing: -1px;
    color: var(--text);
    word-break: break-all;
    text-align: right;
  }

  .buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1px;
    background: var(--border);
  }

  .btn {
    background: var(--btn-bg);
    border: none;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 1.1rem;
    font-weight: 500;
    padding: 18px;
    cursor: pointer;
    transition: all 0.1s;
    user-select: none;
  }
  .btn:hover { background: var(--btn-op); }
  .btn:active { transform: scale(0.95); }

  .btn.op { background: var(--btn-op); color: var(--accent2); font-weight: 700; }
  .btn.eq { background: var(--btn-eq); color: white; font-weight: 700; font-size: 1.3rem; }
  .btn.eq:hover { filter: brightness(1.1); }
  .btn.clear { color: var(--accent); font-weight: 700; }
  .btn.span2 { grid-column: span 2; }

  /* MODAL OVERLAY */
  .overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(4px);
    z-index: 100;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease;
  }
  .overlay.active { display: flex; }
  @keyframes fadeIn { from{opacity:0} to{opacity:1} }

  /* UPGRADE MODAL */
  .modal {
    background: #fff;
    color: #111;
    border-radius: 12px;
    width: 460px;
    max-width: 95vw;
    max-height: 92vh;
    overflow-y: auto;
    overflow-x: hidden;
    box-shadow: 0 40px 120px rgba(0,0,0,0.7);
    animation: slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1);
    position: relative;
  }
  @keyframes slideUp { from{transform:translateY(40px) scale(0.95);opacity:0} to{transform:none;opacity:1} }

  .modal-header {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    padding: 14px 18px 0;
    position: relative;
    overflow: hidden;
  }
  .modal-header::before {
    content: '';
    position: absolute;
    inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  }

  .modal-close {
    position: absolute;
    top: 12px; right: 12px;
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    color: white;
    width: 32px; height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1rem;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    z-index: 20;
  }
  .modal-close:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }

  .modal-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 6px;
  }
  .modal-logo-icon {
    width: 36px; height: 36px;
    background: linear-gradient(135deg, #ff3c3c, #ff9500);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.1rem;
    box-shadow: 0 4px 15px rgba(255,60,60,0.4);
  }
  .modal-logo-text {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.4rem;
    color: white;
    letter-spacing: 2px;
  }
  .modal-logo-text span { color: #ff9500; }

  .modal-tagline {
    font-size: 0.65rem;
    color: rgba(255,255,255,0.5);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .modal-hero {
    background: linear-gradient(135deg, #ff3c3c, #ff9500);
    padding: 8px 18px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .modal-hero h2 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.4rem;
    color: white;
    letter-spacing: 1px;
    line-height: 1.1;
  }
  .modal-hero .price .new { font-size: 1.5rem; font-weight: 700; line-height: 1; }
  .modal-hero .price {
    text-align: right;
    color: white;
  }
  .modal-hero .price .old { text-decoration: line-through; font-size: 0.75rem; opacity: 0.7; }
  .modal-hero .price .period { font-size: 0.65rem; opacity: 0.8; }

  .modal-body { padding: 10px 18px 4px; }

  .features-title {
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #666;
    margin-bottom: 8px;
  }

  .feature {
    display: flex;
    gap: 8px;
    align-items: baseline;
    margin-bottom: 6px;
    font-size: 0.8rem;
    color: #555;
    line-height: 1.3;
  }
  .feature .icon {
    width: 18px; height: 18px;
    background: linear-gradient(135deg, #ff3c3c, #ff9500);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: white;
    font-size: 0.6rem;
    flex-shrink: 0;
    margin-top: 1px;
  }
  .feature strong { color: #111; font-size: 0.82rem; }
  .feature span { color: #777; font-size: 0.78rem; }

  .modal-footer { padding: 0 18px 14px; }

  .btn-buy {
    width: 100%;
    background: linear-gradient(135deg, #ff3c3c, #ff9500);
    border: none;
    color: white;
    padding: 16px;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.2s;
    letter-spacing: 0.5px;
  }
  .btn-buy:hover { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 8px 25px rgba(255,60,60,0.4); }

  .explosion-overlay {
    display: none;
    position: fixed;
    z-index: 999;
    pointer-events: none;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background: transparent;
  }
  .explosion-overlay.active { display: flex; }

  /* Explosi√≥n: blend screen para quitar fondo negro */
  #media-explosion video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    mix-blend-mode: screen;
  }

  .modal-fine {
    text-align: center;
    font-size: 0.65rem;
    color: #aaa;
    margin-top: 10px;
    line-height: 1.5;
  }

  .trust-badges {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin: 6px 0 10px;
  }
  .trust-badge {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    font-size: 0.6rem;
    color: #999;
    text-align: center;
  }
  .trust-badge .icon { font-size: 1rem; }

  /* THEME SELECTOR MODAL */
  .theme-modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    width: 340px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    animation: slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1);
  }

  @media (max-width: 480px) {
    .theme-modal {
      width: 100vw;
      border-radius: 16px 16px 0 0;
      animation: slideUpMobile 0.3s cubic-bezier(0.34,1.2,0.64,1);
    }
  }
  .theme-modal h3 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
    color: var(--text);
    margin-bottom: 6px;
  }
  .theme-modal p {
    font-size: 0.8rem;
    color: var(--muted);
    margin-bottom: 20px;
  }
  .theme-options { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
  .theme-option {
    border: 2px solid var(--border);
    border-radius: 8px;
    padding: 12px 8px;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
    background: var(--surface2);
  }
  .theme-option:hover { border-color: var(--accent); }
  .theme-option.active { border-color: var(--accent); }
  .theme-option .preview {
    width: 40px; height: 26px;
    border-radius: 4px;
    margin: 0 auto 6px;
  }
  .theme-option span {
    font-size: 0.7rem;
    color: var(--text);
    font-weight: 500;
  }
  .theme-close-btn {
    margin-top: 16px;
    width: 100%;
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
  }
  .theme-close-btn:hover { border-color: var(--accent); }

  /* ===== RESPONSIVE ===== */

  /* Tablet (max 768px) */
  @media (max-width: 768px) {
    header { padding: 10px 16px; }
    .logo { font-size: 1.3rem; }
    .badge { display: none; }
    .theme-btn { padding: 5px 10px; font-size: 0.75rem; }

    .calc-wrapper { padding: 12px; margin-top: 56px; }
    .calc { width: 100%; max-width: 380px; border-radius: 12px; }
    .display { padding: 16px 16px 10px; min-height: 85px; }
    .display .main { font-size: 2rem; }
    .btn { padding: 15px; font-size: 1rem; }

    .modal { width: 95vw; max-height: 88vh; border-radius: 10px; }
    .modal-header { padding: 14px 16px 0; }
    .modal-logo-icon { width: 36px; height: 36px; font-size: 1.1rem; }
    .modal-logo-text { font-size: 1.3rem; }
    .modal-tagline { font-size: 0.65rem; margin-bottom: 8px; }
    .modal-hero { padding: 10px 16px; }
    .modal-hero h2 { font-size: 1.4rem; }
    .modal-hero .price .new { font-size: 1.5rem; }
    .modal-body { padding: 12px 16px 6px; }
    .modal-footer { padding: 0 16px 16px; }
    .feature { margin-bottom: 7px; font-size: 0.82rem; }
    .feature span { font-size: 0.73rem; }
    .btn-buy { padding: 13px; font-size: 0.9rem; }
    .trust-badge { font-size: 0.6rem; }
    .modal-fine { font-size: 0.6rem; }

    .theme-modal { width: 92vw; padding: 18px; }
  }

  /* Mobile (max 480px) */
  @media (max-width: 480px) {
    body { justify-content: flex-start; }
    header { padding: 9px 12px; }
    .logo { font-size: 1.2rem; }
    .theme-btn { font-size: 0.7rem; padding: 4px 8px; }

    .calc-wrapper {
      margin-top: 52px;
      margin-bottom: 36px;
      padding: 8px;
      width: 100%;
      display: flex;
      justify-content: center;
    }

    .calc {
      width: 100%;
      max-width: 100%;
      border-radius: 0;
      border-left: none;
      border-right: none;
      box-shadow: none;
    }

    .display { padding: 14px 14px 10px; min-height: 80px; }
    .display .main { font-size: 1.9rem; }
    .display .sub { font-size: 0.72rem; }

    .btn { padding: 17px 10px; font-size: 1rem; }
    .btn.eq { font-size: 1.2rem; }

    /* Modal full screen on mobile */
    .overlay { align-items: flex-end; }
    .modal {
      width: 100vw;
      max-width: 100vw;
      max-height: 92vh;
      border-radius: 16px 16px 0 0;
      animation: slideUpMobile 0.3s cubic-bezier(0.34,1.2,0.64,1);
    }
    @keyframes slideUpMobile {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: none; opacity: 1; }
    }

    .modal-hero { flex-direction: column; align-items: flex-start; gap: 6px; padding: 10px 14px; }
    .modal-hero .price { text-align: left; }
    .modal-hero h2 { font-size: 1.3rem; }

    .modal-body { padding: 10px 14px 4px; }
    .modal-footer { padding: 0 14px 20px; }
    .trust-badges { gap: 10px; }

    .theme-modal { width: 100vw; border-radius: 16px 16px 0 0; }
    .overlay:has(.theme-modal) { align-items: flex-end; }

    .disclaimer { font-size: 0.55rem; padding: 5px 10px; }
  }

  /* Very small (max 360px) */
  @media (max-width: 360px) {
    .btn { padding: 14px 8px; font-size: 0.9rem; }
    .display .main { font-size: 1.6rem; }
    .modal-hero h2 { font-size: 1.1rem; }
    .feature strong { font-size: 0.78rem; }
    .feature span { font-size: 0.68rem; }
  }

  /* disclaimer bar */
  .disclaimer {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--surface);
    border-top: 1px solid var(--border);
    padding: 6px 16px;
    font-size: 0.65rem;
    color: var(--muted);
    text-align: center;
  }
</style>
</head>
<body>

<header>
  <div class="logo">CALC<span>PRO</span></div>
  <div class="header-right">
    <span class="badge">FREE TRIAL</span>
    <button class="theme-btn" onclick="openUpgrade('theme')">üé® Tema</button>
  </div>
</header>

<div class="calc-wrapper">
  <div class="calc">
    <div class="display">
      <div class="sub" id="sub-display"></div>
      <div class="main" id="main-display">0</div>
    </div>
    <div class="buttons">
      <button class="btn clear" onclick="clearAll()">AC</button>
      <button class="btn op" onclick="toggleSign()">+/-</button>
      <button class="btn op" onclick="percent()">%</button>
      <button class="btn op" onclick="op('/')">√∑</button>

      <button class="btn" onclick="num('7')">7</button>
      <button class="btn" onclick="num('8')">8</button>
      <button class="btn" onclick="num('9')">9</button>
      <button class="btn op" onclick="op('*')">√ó</button>

      <button class="btn" onclick="num('4')">4</button>
      <button class="btn" onclick="num('5')">5</button>
      <button class="btn" onclick="num('6')">6</button>
      <button class="btn op" onclick="op('-')">‚àí</button>

      <button class="btn" onclick="num('1')">1</button>
      <button class="btn" onclick="num('2')">2</button>
      <button class="btn" onclick="num('3')">3</button>
      <button class="btn op" onclick="op('+')">+</button>

      <button class="btn span2" onclick="num('0')">0</button>
      <button class="btn" onclick="num('.')">.</button>
      <button class="btn eq" onclick="calculate()">=</button>
    </div>
  </div>
</div>

<div class="disclaimer">
  CalcPro‚Ñ¢ es software protegido. Usar el bot√≥n "=" en la versi√≥n gratuita viola nuestros t√©rminos de servicio, la convenci√≥n de Ginebra y posiblemente las leyes de 3 pa√≠ses.
</div>

<!-- UPGRADE MODAL -->
<div class="overlay" id="upgrade-overlay">
  <div class="modal" id="upgrade-modal">
    <button class="modal-close" onclick="closeUpgrade()">‚úï</button>
    <div class="modal-header">
      <div class="modal-logo">
        <div class="modal-logo-icon">üßÆ</div>
        <div>
          <div class="modal-logo-text">CALC<span>PRO</span></div>
          <div class="modal-tagline">Calcula sin l√≠mites‚Ñ¢</div>
        </div>
      </div>
    </div>

    <div class="modal-hero">
      <div>
        <h2 id="modal-title">DESBLOQUEA EL<br>BOT√ìN IGUAL</h2>
        <div style="font-size:0.75rem;color:rgba(255,255,255,0.8);margin-top:4px;">Oferta por tiempo limitado üî•</div>
      </div>
      <div class="price">
        <div class="old">$99.99/mes</div>
        <div class="new">$4.99</div>
        <div class="period">por mes (cobrado anualmente)</div>
      </div>
    </div>

    <div class="modal-body">
      <div class="features-title">‚ú¶ Lo que obtienes con CalcPro+</div>

      <div class="feature">
        <div class="icon">‚úì</div>
        <div><strong>Bot√≥n Igual‚Ñ¢ Desbloqueado</strong> ‚Äî <span>Calcula resultados reales. Tecnolog√≠a de punta nunca antes vista.</span></div>
      </div>
      <div class="feature">
        <div class="icon">‚úì</div>
        <div><strong>Modo Oscuro Premium</strong> ‚Äî <span>Fondo negro EXCLUSIVO de usuarios Pro. Protege tus ojos (y tu alma).</span></div>
      </div>
      <div class="feature">
        <div class="icon">‚úì</div>
        <div><strong>IA CalcBrain‚Ñ¢</strong> ‚Äî <span>Nuestra IA aprende tus c√°lculos favoritos y los cobra por separado.</span></div>
      </div>
      <div class="feature">
        <div class="icon">‚úì</div>
        <div><strong>Soporte Premium 24/7</strong> ‚Äî <span>Un bot te responder√° con el mismo texto gen√©rico en cualquier idioma.</span></div>
      </div>
      <div class="feature">
        <div class="icon">‚úì</div>
        <div><strong>Sin anuncios*</strong> ‚Äî <span>*Excepto los anuncios de nuestros socios estrat√©gicos (todos).</span></div>
      </div>
    </div>

    <div class="modal-footer">
      <div class="trust-badges">
        <div class="trust-badge"><div class="icon">üîí</div><div>SSL Seguro<br>Probablemente</div></div>
        <div class="trust-badge"><div class="icon">‚≠ê</div><div>4.9‚òÖ en<br>nuestra web</div></div>
        <div class="trust-badge"><div class="icon">üèÜ</div><div>Premio al<br>Mayor Descaro 2024</div></div>
      </div>

      <button class="btn-buy" onclick="buyPro()">
        üöÄ OBTENER CALCPRO+ AHORA
      </button>

      <div class="modal-fine">
        Al comprar aceptas nuestros t√©rminos y condiciones (847 p√°ginas), la cesi√≥n de tus datos biom√©tricos, 
        y que tu suscripci√≥n se renueva autom√°ticamente hasta el fin del universo. 
        Para cancelar debes llamar entre 2-4 AM un martes de a√±o bisiesto.
      </div>
    </div>
  </div>
</div>

<!-- EXPLOSION -->
<div class="explosion-overlay" id="media-explosion">
  <video id="vid-explosion" playsinline>
    <source src="explosion.mp4" type="video/mp4">
  </video>
</div>

<!-- THEME MODAL -->
<div class="overlay" id="theme-overlay">
  <div class="theme-modal">
    <h3>ELIGE TU TEMA</h3>
    <p>Personaliza tu experiencia de calcular sin calcular</p>
    <div class="theme-options">
      <div class="theme-option active" id="t-dark" onclick="setTheme('dark', this)">
        <div class="preview" style="background:linear-gradient(135deg,#0f0f0f,#1a1a1a)"></div>
        <span>Oscuro</span>
      </div>
      <div class="theme-option" id="t-light" onclick="setTheme('light', this)">
        <div class="preview" style="background:linear-gradient(135deg,#e8e8e8,#f2f2f2)"></div>
        <span>Claro</span>
      </div>
      <div class="theme-option" id="t-retro" onclick="setTheme('retro', this)">
        <div class="preview" style="background:linear-gradient(135deg,#1a0a00,#ff9900);"></div>
        <span>Retro</span>
      </div>
    </div>
    <button class="theme-close-btn" onclick="closeTheme()">Cerrar</button>
  </div>
</div>

<script>
  let current = '0';
  let prev = '';
  let operator = null;
  let newNum = true;

  function updateDisplay() {
    document.getElementById('main-display').textContent = current;
    document.getElementById('sub-display').textContent = prev ? `${prev} ${opSymbol()}` : '';
  }

  function opSymbol() {
    const map = {'+':'+','-':'‚àí','*':'√ó','/':'√∑'};
    return operator ? map[operator] : '';
  }

  function num(n) {
    if (newNum) { current = n === '.' ? '0.' : n; newNum = false; }
    else {
      if (n === '.' && current.includes('.')) return;
      if (current === '0' && n !== '.') current = n;
      else current += n;
    }
    if (current.length > 12) current = current.slice(0, 12);
    updateDisplay();
  }

  function op(o) {
    prev = current;
    operator = o;
    newNum = true;
    updateDisplay();
  }

  function calculate() {
    openUpgrade('equal');
  }

  function clearAll() {
    current = '0'; prev = ''; operator = null; newNum = true;
    updateDisplay();
  }

  function toggleSign() {
    current = (parseFloat(current) * -1).toString();
    updateDisplay();
  }

  function percent() {
    current = (parseFloat(current) / 100).toString();
    updateDisplay();
  }

  // Upgrade modal
  function openUpgrade(trigger) {
    const titles = {
      equal: 'DESBLOQUEA EL<br>BOT√ìN IGUAL',
      theme: 'LOS TEMAS SON<br>CARACTER√çSTICA PRO',
    };
    document.getElementById('modal-title').innerHTML = titles[trigger] || titles.equal;
    document.getElementById('upgrade-overlay').classList.add('active');
  }

  function closeUpgrade() {
    document.getElementById('upgrade-overlay').classList.remove('active');
    const overlay = document.getElementById('media-explosion');
    overlay.classList.remove('active');
    const vid = document.getElementById('vid-explosion');
    vid.pause();
    vid.currentTime = 0;
  }

  function posicionarSobreModal(overlayId) {
    const modal = document.getElementById('upgrade-modal');
    const rect = modal.getBoundingClientRect();
    const el = document.getElementById(overlayId);
    el.style.left   = rect.left + 'px';
    el.style.top    = rect.top  + 'px';
    el.style.width  = rect.width  + 'px';
    el.style.height = rect.height + 'px';
  }

  function buyPro() {
    // 25% de chance de mandarte al link, 75% explosi√≥n
    if (Math.random() < 0.25) {
      window.open('https://youtu.be/X_8Nh5XfRw0?si=c1xw3QxEnsdkq4mp', '_blank');
      return;
    }

    posicionarSobreModal('media-explosion');
    const overlay = document.getElementById('media-explosion');
    const vid = document.getElementById('vid-explosion');

    overlay.classList.add('active');
    vid.currentTime = 0;
    vid.play();

    const hide = () => {
      overlay.classList.remove('active');
      vid.pause();
      vid.currentTime = 0;
      vid.removeEventListener('ended', hide);
    };
    vid.addEventListener('ended', hide);
    setTimeout(hide, 8000);
  }

  // Theme
  function openTheme() {
    const ov = document.getElementById('theme-overlay');
    if (window.innerWidth <= 480) ov.style.alignItems = 'flex-end';
    else ov.style.alignItems = 'center';
    ov.classList.add('active');
  }
  function closeTheme() {
    document.getElementById('theme-overlay').classList.remove('active');
  }

  let currentTheme = 'dark';
  function setTheme(t, el) {
    document.body.className = t === 'dark' ? '' : `theme-${t}`;
    currentTheme = t;
    document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
    el.classList.add('active');
  }

  // Close overlay on bg click
  document.getElementById('theme-overlay').addEventListener('click', function(e) {
    if (e.target === this) closeTheme();
  });
</script>
</body>
</html>
